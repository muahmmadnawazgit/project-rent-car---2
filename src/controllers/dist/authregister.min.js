"use strict";var bcrypt=require("bcryptjs"),con=require("../db.js"),nodemailer=require("nodemailer");exports.register=function(n,s){var e=n.body,o=e.email,i=e.name,c=e.password,m=(e.mobile,e.Confirmpassword);e.verify,e.register_at;console.log(n.body),con.query("SELECT email,name FROM users WHERE email=? OR name=?",[o,i],function(r,a){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r)throw r;e.next=2;break;case 2:if(0<a.length)return n.flash("message","user already exsits"),e.abrupt("return",s.redirect("/register"));e.next=7;break;case 7:if(c!=m)return n.flash("message","password does not match"),e.abrupt("return",s.redirect("/register"));e.next=10;break;case 10:return e.next=12,regeneratorRuntime.awrap(bcrypt.hashSync(c,8));case 12:t=e.sent,con.query("INSERT INTO users SET ?",{name:i,password:t,email:o,verify:0},function(e,r){if(e)throw e;con.query("SELECT * FROM users WHERE email=?",[o],function(e,r){if(e)throw e;if(0<r.length)return a=o,t=r[0].id,i={from:"muhammadnawaz110002@gmail.com",to:a=a,subject:"email verification",html:'<p>Welcome to StarShine plz verify your link <a href="http://localhost:3000/Verify-Email?id='+(t=t)+'">Verify</a></p>'},nodemailer.createTransport({host:"smtp.gmail.com",port:587,secure:!1,requireTLS:!0,auth:{user:"muhammadnawaz110002@gmail.com",pass:"fdbtwhlfzoddxczn"}}).sendMail(i,function(e,r){if(e)throw e}),n.flash("message","Verification link has been sent Please Verify"),s.redirect("/login");var a,t,i})});case 14:case"end":return e.stop()}})})};
//# sourceMappingURL=authregister.min.js.map
